<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:include="/common/common_css :: commonHead('首页')">
<meta content="text/html;charset=UTF-8"/>
<title sec:authentication="name"></title>
</head>
<body class="hold-transition skin-blue sidebar-mini" style="font-size: 11">
<div class="wrapper">
<header th:replace="/common/template :: header(1)"></header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar" th:replace="/common/template :: menu('2','1')"></aside>
  
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
  <section class="content-header" th:replace="/common/template :: breadcrumb('2')"></section>
  <section class="content">
  	<!-- 查询 start -->
    		<div class="row" style="font-size:small;">
		  		<div class="col-sm-12">
		   		 <div class="box box-info">
		            <div class="box-header">
		              	<div class="pull-left">
                    		<!-- <button id="addUserBtn" type="button" class="btn btn-info btn-xs pull-right">新增用户</button> -->
                  		</div>
		              	<div class="pull-left">
                    		
                  		</div>
		            </div>
		            <!-- /.box-header -->
	                <form class="form-horizontal" th:action="@{/user/get}" th:method="get">
	                  <div class="box-body">
	                    <div class="form-group">
	                      <label for="inputEmail3" class="col-sm-2 control-label">关键词</label>
	
	                      <div class="col-sm-12 col-md-3">
	                        <input type="text" class="form-control" id="keywords" name="keywords" >
	                      </div>
	                      
	                      <div class="col-sm-12 col-md-2 pull-right">
	                      	<button type="button" class="btn btn-success  pull-right btn-flushTable">查询</button>
	                      </div>
	                    </div>
	                  </div>
	                </form>
		            <!-- /.box-body -->
		          </div>
		          <!-- /.box -->
		  
			  </div>
			</div>
    		<!-- 查询 end -->
		    <!-- 数据 start-->
		    	<div class="row">
		  		<div class="col-lg-12 col-xs-12">
		   		 <div class="box box-primary">
		            <div class="box-header">
		              <h4 class="box-title">用户列表</h4>
		            </div>
		            <!-- /.box-header -->
		            <div class="box-body">
		              <table id="example2" class="table table-bordered table-striped table-hover table-condensed" width="100%">
		                <thead>
		                <tr>
		                  <th>用户名</th>
		                  <th>昵称</th>
		                  <th>状态</th>
		                  <th>操作</th>
		                </tr>
		                </thead>
		                <tbody>
		             
		              </table>
		            </div>
		            <!-- /.box-body -->
		          </div>
		          <!-- /.box -->
		  
		  </div>
		</div>
		    <!-- 数据 end  -->
  </section>		
  </div>  
  <!-- /.content-wrapper -->
  <footer class="main-footer" th:replace="/common/template :: footer">
  </footer>

 
 
</div>
<!-- ./wrapper -->

<span th:replace="/common/common_js :: common"></span>
<span th:replace="/common/common_js :: layer"></span>
<!-- page script -->
<script>
    var form1Table;
	function flushTable(){
		form1Table.ajax.url('/user/ajax_get?keywords='+$("#keywords").val()).load();
	}
	
	$.fn.dataTable.ext.buttons.alert = {
		    className: 'buttons-alert',
		 
		    action: function ( e, dt, node, config ) {
		        alert( this.text() );
		    }
		};
	
  $(function () {
	  form1Table = $('#example2').DataTable({
	        "language": {
	            "url": "/ALTE/bower_components/datatables.net/datatable.zh_CN.lang"
	        },
	        "processing": true,
	      	//开启服务器模式
	        serverSide: true,
	        ajax: {
	            url: '/user/ajax_get?keywords='+$("#keywords").val(),
	            dataSrc: 'data'
	        },
	        dom: 'Bfrtip',
	        buttons: [
	            {
	                extend: 'alert',
	                text: 'My button 1'
	            },
	            {
	                extend: 'alert',
	                text: 'My button 2'
	            },
	            {
	                extend: 'alert',
	                text: 'My button 3'
	            }
	        ],
	        columns:[
	        	{"data":"userName"},
	        	{"data":"fullname"},
	        	{"data":"status"},
	        ]
	    });


    //绑定新增按钮操作
    $('.btn-flushTable').click(function(){
    	flushTable();
    });
  	
    //绑定新增按钮操作
    $('#addUserBtn').click(function(){
    	openWindow("新增用户","/user/modify");
    });
    //绑定编辑按钮
    $(".fix-update").click(function(){
    	openWindow("编辑用户","/user/modify/"+$(this).attr("value"));
    });
    //查看按钮
    $(".fix-detail").click(function(){
    	openWindow("查看用户","/user/detail/"+$(this).attr("value"));
    });
    //冻结按钮
    $(".fix-stop").click(function(){
    	var id = $(this).attr("value");
   		$.ajax({
   	        timeout : 20000,
   	        type : "get",
   	     	processData: false, 
   	  		contentType : false,
   	        dataType : "json",
   	        url : "/user/stop/"+id,
   	        success : function(data){
   	        	successNotify(data.title,data.content);
   	        },
   	        error : function(data){
   	        	errorNotify(data.title,data.content);
   	        }
   	    });
    });
    
    //激活按钮
    $(".fix-active").click(function(){
    	var id = $(this).attr("value");
   		$.ajax({
   	        timeout : 20000,
   	        type : "get",
   	     	processData: false, 
   	  		contentType : false,
   	        dataType : "json",
   	        url : "/user/active/"+id,
   	        success : function(data){
   	        	successNotify(data.title,data.content);
   	        },
   	        error : function(data){
   	        	errorNotify(data.title,data.content);
   	        }
   	    });
    });
    
    //删除按钮
    $(".fix-delete").click(function(){
    	var id = $(this).attr("value");
    	var formData = new FormData();
    	formData.append("userIds",id);
   		$.ajax({
   	        timeout : 20000,
   	        type : "post",
   	     	processData: false, 
   	  		contentType : false,
   	        dataType : "json",
   	        url : "/user/delete",
   	        data : formData,
   	        success : function(data){
   	        	successNotify(data.title,data.content);
   	        },
   	        error : function(data){
   	        	errorNotify(data.title,data.content);
   	        }
   	    });
    });
    
  });
    

</script>
</body>
</html>