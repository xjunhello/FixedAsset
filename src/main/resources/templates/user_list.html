<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:include="/common/common_css :: commonHead('首页')">
<meta content="text/html;charset=UTF-8"/>
<title sec:authentication="name"></title>
</head>
<body class="hold-transition skin-blue sidebar-mini" style="font-size: 11">
<div class="wrapper">
<header th:replace="/common/template :: header(1)"></header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar" th:replace="/common/template :: menu('2','1')"></aside>
  
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
  <section class="content-header" th:replace="/common/template :: breadcrumb('2')"></section>
  <section class="content">
  	<!-- 查询 start -->
    		<div class="row" style="font-size:small;">
		  		<div class="col-sm-12">
		   		 <div class="box box-info">
		            <div class="box-header">
		              	<div class="pull-left">
                    		<button id="addUserBtn" type="button" class="btn btn-info btn-xs pull-right">新增用户</button>
                  		</div>
		              	<div class="pull-left">
                    		
                  		</div>
		            </div>
		            <!-- /.box-header -->
	                <form class="form-horizontal" th:action="@{/user/get}" th:method="get">
	                  <div class="box-body">
	                    <div class="form-group">
	                      <label for="inputEmail3" class="col-sm-2 control-label">关键词</label>
	
	                      <div class="col-sm-12 col-md-3">
	                        <input type="text" class="form-control" id="keywords" name="keywords" th:value="${page.params['keywords']}">
	                      </div>
	                      
	                      <div class="col-sm-12 col-md-2 pull-right">
	                      	<button type="submit" class="btn btn-success  pull-right">查询</button>
	                      </div>
	                    </div>
	                  </div>
	                </form>
		            <!-- /.box-body -->
		          </div>
		          <!-- /.box -->
		  
			  </div>
			</div>
    		<!-- 查询 end -->
		    <!-- 数据 start-->
		    	<div class="row">
		  		<div class="col-lg-12 col-xs-12">
		   		 <div class="box box-primary">
		            <div class="box-header">
		              <h4 class="box-title">用户列表</h4>
		            </div>
		            <!-- /.box-header -->
		            <div class="box-body">
		              <table id="example2" class="table table-bordered table-striped table-hover table-condensed">
		                <thead>
		                <tr>
		                  <th>用户名</th>
		                  <th>昵称</th>
		                  <th>状态</th>
		                  <th width="15%">操作</th>
		                </tr>
		                </thead>
		                <tbody>
		                
		                <tr th:each="user : ${page.list}"  >
		                  <td th:text="${user.userName}">2018-01-01</td>
		                  <td th:text="${user.fullname}">王主任
		                  </td >
		                  <td  >
		                  <span th:if="${user.status == 0}" class="label label-success" >正常</span>
		                  <span th:if="${user.status == 1}" class="label label-danger">冻结</span>
		                  </td>
		                  <td>
		                  	<button th:value="${user.userId}" type="button" class="btn  btn-success btn-xs fix-update">编辑</button>
		                  	<button th:value="${user.userId}" th:if="${user.status == 0}" type="button" class="btn  btn-danger btn-xs fix-coll">冻结</button>
		                  	<button th:value="${user.userId}" th:if="${user.status == 1}" type="button" class="btn  btn-success btn-xs fix-coll">激活</button>
		                  	<button th:value="${user.userId}" type="button" class="btn  btn-info btn-xs fix-detail">查看</button>
		                  	<button th:value="${user.userId}" type="button" class="btn  btn-danger btn-xs fix-delete">删除</button>
		                  </td>
		                </tr>
		                
		              </table>
		            </div>
		            <!-- /.box-body -->
		          </div>
		          <!-- /.box -->
		  
		  </div>
		</div>
		    <!-- 数据 end  -->
  </section>		
  </div>  
  <!-- /.content-wrapper -->
  <footer class="main-footer" th:replace="/common/template :: footer">
  </footer>

 
 
</div>
<!-- ./wrapper -->

<span th:replace="/common/common_js :: common"></span>
<span th:replace="/common/common_js :: layer"></span>
<!-- page script -->
<script>

  $(function () {
  /**$('#example2').DataTable({
        "language": {
            "url": "/ALTE/bower_components/datatables.net/datatable.zh_CN.lang"
        }
    });*/
    
    //初始化table  
    var oTable1 = $('#example2')  
            .dataTable(  
                    {  
                        "bPaginate" : true,//分页工具条显示  
                        //"sPaginationType" : "full_numbers",//分页工具条样式  
                        "bStateSave" : true, //是否打开客户端状态记录功能,此功能在ajax刷新纪录的时候不会将个性化设定回复为初始化状态    
                        "bScrollCollapse" : true, //当显示的数据不足以支撑表格的默认的高度  
                        "bLengthChange" : true, //每页显示的记录数  
                        "bFilter" : false, //搜索栏  
                        "bSort" : true, //是否支持排序功能  
                        "bInfo" : true, //显示表格信息  
                        "bAutoWidth" : true, //自适应宽度  
                        "bJQueryUI" : false,//是否开启主题  
                        "bDestroy" : true,  
                        "bProcessing" : true, //开启读取服务器数据时显示正在加载中……特别是大数据量的时候，开启此功能比较好  
                        "bServerSide" : true,//服务器处理分页，默认是false，需要服务器处理，必须true  
                        "sAjaxDataProp" : "aData",//是服务器分页的标志，必须有   
                        "sAjaxSource" : "/user/ajax_get",//通过ajax实现分页的url路径。    
                        "aoColumns" : [//初始化要显示的列  
                                {  
                                    "mDataProp" : "userId",//获取列数据，跟服务器返回字段一致  
                                    "sClass" : "center",//显示样式  
                                    "mRender" : function(data, type, full) {//返回自定义的样式  
                                        return "<label><input type='checkbox' class='ace' /><span class='lbl'></span></label>"  
                                    }  
                                },  
                                {  
                                    "mDataProp" : "userName"  
                                }, {  
                                    "mDataProp" : "fullName"  
                                }, 
                                {  
                                    "mDataProp" : "status"  
                                }, 
                                {  
                                    "mDataProp" : "status"  
                                }],  
                        "aoColumnDefs" : [ {//用来设置列一些特殊列的属性  
                            "bSortable" : false,  
                            "aTargets" : [ 0 ]  
                        //第一列不排序  
                        }, {  
                            "bSortable" : false,  
                            "aTargets" : [ 1 ]  
                        }, {  
                            "bSortable" : false,  
                            "aTargets" : [ 2 ]  
                        } ],  
                        "oLanguage" : {//语言设置  
                            "sProcessing" : "处理中...",  
                            "sLengthMenu" : "显示 _MENU_ 项结果",  
                            "sZeroRecords" : "没有匹配结果",  
                            "sInfo" : "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",  
                            "sInfoEmpty" : "显示第 0 至 0 项结果，共 0 项",  
                            "sInfoFiltered" : "(由 _MAX_ 项结果过滤)",  
                            "sInfoPostFix" : "",  
                            "sSearch" : "搜索:",  
                            "sUrl" : "",  
                            "sEmptyTable" : "表中数据为空",  
                            "sLoadingRecords" : "载入中...",  
                            "sInfoThousands" : ",",  
                            "oPaginate" : {  
                                "sFirst" : "首页",  
                                "sPrevious" : "上页",  
                                "sNext" : "下页",  
                                "sLast" : "末页"  
                            },  
                            "oAria" : {  
                                "sSortAscending" : ": 以升序排列此列",  
                                "sSortDescending" : ": 以降序排列此列"  
                            }  
                        }  
                    });  

    //全选  
    $('table th input:checkbox').on(  
            'click',  
            function() {  
                var that = this;  
                $(this).closest('table').find(  
                        'tr > td:first-child input:checkbox').each(  
                        function() {  
                            this.checked = that.checked;  
                            $(this).closest('tr').toggleClass('selected');  
                        });  

            });  

});  
  
    //绑定新增按钮操作
    $('#addUserBtn').click(function(){
    	openWindow("新增用户","/user/modify");
    });
    //绑定编辑按钮
    $(".fix-update").click(function(){
    	openWindow("编辑用户","/user/modify/"+$(this).attr("value"));
    });
    //查看按钮
    $(".fix-detail").click(function(){
    	openWindow("查看用户","/user/detail/"+$(this).attr("value"));
    });
    //冻结按钮
    $(".fix-stop").click(function(){
    	var id = $(this).attr("value");
   		$.ajax({
   	        timeout : 20000,
   	        type : "get",
   	     	processData: false, 
   	  		contentType : false,
   	        dataType : "json",
   	        url : "/user/stop/"+id,
   	        success : function(data){
   	        	successNotify(data.title,data.content);
   	        },
   	        error : function(data){
   	        	errorNotify(data.title,data.content);
   	        }
   	    });
    });
    
    //激活按钮
    $(".fix-active").click(function(){
    	var id = $(this).attr("value");
   		$.ajax({
   	        timeout : 20000,
   	        type : "get",
   	     	processData: false, 
   	  		contentType : false,
   	        dataType : "json",
   	        url : "/user/active/"+id,
   	        success : function(data){
   	        	successNotify(data.title,data.content);
   	        },
   	        error : function(data){
   	        	errorNotify(data.title,data.content);
   	        }
   	    });
    });
    
    //删除按钮
    $(".fix-delete").click(function(){
    	var id = $(this).attr("value");
    	var formData = new FormData();
    	formData.append("userIds",id);
   		$.ajax({
   	        timeout : 20000,
   	        type : "post",
   	     	processData: false, 
   	  		contentType : false,
   	        dataType : "json",
   	        url : "/user/delete",
   	        data : formData,
   	        success : function(data){
   	        	successNotify(data.title,data.content);
   	        },
   	        error : function(data){
   	        	errorNotify(data.title,data.content);
   	        }
   	    });
    });
    
  });
    

</script>
</body>
</html>